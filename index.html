<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHI’S EMPIRE</title>

<style>
body { font-family: Arial; margin:0; background:#f5f5f5; }
header { background:#000; color:#fff; padding:15px; text-align:center; }
.container { padding:20px; }
.controls { display:flex; gap:10px; margin-bottom:15px; }
.controls input, .controls select { flex:1; padding:8px; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:20px; margin-bottom:40px; }
.card { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.card img { width:100%; height:180px; object-fit:cover; border-radius:8px; }
.badge { padding:4px 8px; border-radius:5px; font-size:12px; color:#fff; display:inline-block; margin-bottom:6px; }
.low { background:orange; }
.out { background:red; }
select,button,input { width:100%; padding:8px; margin-top:6px; }
button { background:black; color:white; border:none; cursor:pointer; }
.cart { position:fixed; right:0; top:0; width:320px; height:100%; background:white; box-shadow:-3px 0 8px rgba(0,0,0,0.1); padding:15px; overflow:auto; }
.checkout { background:green; }
.remove-btn { background:red; margin-top:4px; width:100%; }
h3.section-title { margin-top:0; }
</style>
</head>

<body>

<header>
  <h2>CHI’S EMPIRE STORE</h2>
</header>

<div class="container">

  <div class="controls">
    <input type="text" id="search" placeholder="Search products..." onkeyup="applyFilters()">
    <select id="category" onchange="applyFilters()">
      <option value="All">All Categories</option>
      <option value="Clothing">Clothing</option>
      <option value="Shoes">Shoes</option>
      <option value="Kitchen">Kitchen</option>
    </select>
  </div>

  <!-- Featured Products Section -->
  <h3 class="section-title">Featured Products</h3>
  <div class="grid" id="featured-list"></div>

  <!-- Rest of the Catalog -->
  <h3 class="section-title">All Products</h3>
  <div class="grid" id="product-list"></div>
</div>

<div class="cart">
  <h3>Cart</h3>
  <div id="cart-items"></div>
  <hr>
  <h4>Total: ₦<span id="total">0</span></h4>
  <button class="checkout" onclick="checkout()">Checkout via WhatsApp</button>
</div>

<script>
let products = [];
let cart = [];

// Load CSV
fetch("products.csv")
.then(res => res.text())
.then(text => {
  const rows = text.trim().split("\n").slice(1);
  products = rows.map(row => {
    const cols = row.split(",");
    return {
      id: cols[0],
      name: cols[1],
      category: cols[2],
      price: Number(cols[3]),
      colors: cols[4].split("|"),
      sizes: cols[5].split("|"),
      stock: Number(cols[6]),
      image: cols[7]
    }
  });

  loadSavedStock();
  renderProducts();
});

// SAVE STOCK PERMANENTLY
function saveStock() {
  localStorage.setItem("stockData", JSON.stringify(products));
}

function loadSavedStock() {
  const saved = localStorage.getItem("stockData");
  if(saved){
    products = JSON.parse(saved);
  }
}

// RENDER PRODUCTS
function renderProducts(filtered=products){

  // Featured Products (Knife & Spoon)
  const featured = filtered.filter(p => p.name.toLowerCase().includes("knife") || p.name.toLowerCase().includes("spoon"));
  const featuredList = document.getElementById("featured-list");
  featuredList.innerHTML = "";
  featured.forEach(p => featuredList.innerHTML += productCardHTML(p));

  // Rest of catalog (exclude featured)
  const rest = filtered.filter(p => !featured.includes(p));
  const list = document.getElementById("product-list");
  list.innerHTML = "";
  rest.forEach(p => list.innerHTML += productCardHTML(p));
}

// Generate HTML for a single product
function productCardHTML(p){
  let badge = "";
  if(p.stock <= 0){ badge = `<div class="badge out">Out of Stock</div>`; }
  else if(p.stock <= 5){ badge = `<div class="badge low">Low Stock</div>`; }

  return `
      <div class="card">
        ${badge}
        <img src="${p.image}">
        <h4>${p.name}</h4>
        <p>₦${p.price}</p>

        <select id="color-${p.id}">
          ${p.colors.map(c => `<option>${c}</option>`).join("")}
        </select>

        <select id="size-${p.id}">
          ${p.sizes.map(s => `<option>${s}</option>`).join("")}
        </select>

        <input type="number" id="qty-${p.id}" min="1" value="1" max="${p.stock}">

        <p>Stock: ${p.stock}</p>

        <button onclick="addToCart(${p.id})" ${p.stock<=0?"disabled":""}>
          Add to Cart
        </button>
      </div>
  `;
}

// ADD TO CART
function addToCart(id){
  const product = products.find(p => p.id == id);
  let qty = Number(document.getElementById(`qty-${id}`).value);

  if(qty > product.stock){ alert("Not enough stock available"); return; }

  const color = document.getElementById(`color-${id}`).value;
  const size = document.getElementById(`size-${id}`).value;

  cart.push({ id: product.id, name: product.name, price: product.price, color, size, qty });
  product.stock -= qty;

  saveStock();
  renderProducts();
  renderCart();
}

// RENDER CART
function renderCart(){
  const items = document.getElementById("cart-items");
  const total = document.getElementById("total");
  items.innerHTML = "";
  let sum = 0;

  cart.forEach((item,index)=>{
    sum += item.price * item.qty;
    items.innerHTML += `
      <div>
        <b>${item.name}</b><br>
        ${item.color} | ${item.size}<br>
        Qty: ${item.qty}<br>
        ₦${item.price * item.qty}<br>
        <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
        <hr>
      </div>
    `;
  });

  total.innerText = sum;
}

// REMOVE FROM CART
function removeItem(index){
  const item = cart[index];
  const product = products.find(p => p.id == item.id);
  product.stock += item.qty;

  cart.splice(index,1);
  saveStock();
  renderProducts();
  renderCart();
}

// CHECKOUT WHATSAPP
function checkout(){
  if(cart.length===0){ alert("Cart empty"); return; }
  let message = "Hello, I want to order:%0A";
  cart.forEach(item=>{
    message += `${item.name} (${item.color}, ${item.size}) x${item.qty} - ₦${item.price*item.qty}%0A`;
  });
  message += `%0ATotal: ₦${document.getElementById("total").innerText}`;
  window.open(`https://wa.me/2340000000000?text=${message}`);
}

// SEARCH + FILTER
function applyFilters(){
  const query = document.getElementById("search").value.toLowerCase();
  const category = document.getElementById("category").value;

  const filtered = products.filter(p=>{
    const matchName = p.name.toLowerCase().includes(query);
    const matchCategory = category=="All" || p.category==category;
    return matchName && matchCategory;
  });

  renderProducts(filtered);
}
</script>
</body>
</html>
