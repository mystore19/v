<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHI'S EMPIRE</title>

<style>
body{font-family:Arial,sans-serif;margin:0;background:#f8fafc;}
header{background:#0f172a;color:#fff;padding:1rem;text-align:center;}
.controls{display:flex;gap:8px;padding:10px;background:#fff;position:sticky;top:0;z-index:10;}
.controls input,.controls select{padding:10px;flex:1;border-radius:8px;border:1px solid #cbd5e1;}
.catalog{padding:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;}
.product{background:#fff;border-radius:12px;padding:10px;box-shadow:0 6px 16px rgba(0,0,0,.08);display:flex;flex-direction:column;}
.product img{width:100%;height:160px;object-fit:cover;border-radius:10px;}
.product h3{font-size:1.05rem;margin:6px 0;}
.meta{font-size:.8rem;color:#64748b;}
.price{margin:6px 0;}
.qty-box{display:flex;align-items:center;gap:10px;margin:6px 0;}
.qty-box button{padding:6px 10px;font-size:1rem;cursor:pointer;}
.btn{background:#25d366;color:#fff;padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.cart-btn{position:fixed;bottom:20px;right:20px;background:#0f172a;color:#fff;padding:16px 20px;border-radius:40px;border:none;z-index:200;}
#cartSidebar{position:fixed;top:0;right:-420px;width:380px;height:100%;background:#fff;box-shadow:-8px 0 30px rgba(0,0,0,.25);z-index:1000;transition:right .35s ease;display:flex;flex-direction:column;}
#cartSidebar.open{right:0;}
#cartBox{flex:1;overflow-y:auto;padding:1rem;}
#cartBackdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:.3s;z-index:900;}
#cartSidebar.open~#cartBackdrop{opacity:1;pointer-events:auto;}
#checkoutBtn{width:100%;padding:14px;font-size:1.05rem;margin-top:10px;}
</style>
</head>

<body>

<header>
  <h2>CHI'S EMPIRE</h2>
  <p>Store</p>
</header>

<div class="controls">
  <input id="search" placeholder="Search..." onkeyup="filterProducts()">
  <select id="category" onchange="filterProducts()">
    <option value="all">All</option>
    <option value="Clothing">Clothing</option>
    <option value="Shoes">Shoes</option>
    <option value="Kitchen">Kitchen</option>
  </select>
</div>

<section id="catalog" class="catalog"></section>

<button class="cart-btn" onclick="openCart()">ðŸ›’ Cart (<span id="cartCount">0</span>)</button>

<div id="cartSidebar">
  <div id="cartBox">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <p id="cartTotal"></p>

    <button id="checkoutBtn" class="btn" onclick="checkoutWhatsApp()">Checkout on WhatsApp</button>
    <button onclick="closeCart()" style="width:100%;margin-top:8px;">Continue Shopping</button>
  </div>
</div>

<div id="cartBackdrop" onclick="closeCart()"></div>

<script>

const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSU7G-P1I6LZ7x2-2WDWkEHOpglxXTy8yk82pzMgZ4wt903OsbFOkx42ijOrVw4WJmP_9Y8c499Z-EF/pub?output=csv";

let products = [];
let cart = [];
let qty = [];
const DELIVERY_FEE = ;

async function loadProducts(){
  try{
    const res = await fetch(https://docs.google.com/spreadsheets/d/e/2PACX-1vSU7G-P1I6LZ7x2-2WDWkEHOpglxXTy8yk82pzMgZ4wt903OsbFOkx42ijOrVw4WJmP_9Y8c499Z-EF/pub?output=csv);
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);

    rows.forEach(row=>{
      const cols = row.split(",");
      products.push({
        name: cols[1],
        category: cols[2],
        brand: cols[3],
        price: parseInt(cols[4]),
        image: cols[8]
      });
      qty.push(1);
    });

    render(products);

  }catch(err){
    console.error("CSV Load Error:", err);
  }
}

function render(list){
  const catalog = document.getElementById("catalog");
  catalog.innerHTML="";
  list.forEach((p,i)=>{
    catalog.innerHTML += `
      <div class="product">
        <img src="${p.image}">
        <h3>${p.name}</h3>
        <div class="meta">${p.brand} â€¢ ${p.category}</div>
        <div class="price"><b>â‚¦${p.price}</b></div>
        <div class="qty-box">
          <button onclick="chg(${i},-1)">âž–</button>
          <span id="q${i}">${qty[i]}</span>
          <button onclick="chg(${i},1)">âž•</button>
        </div>
        <button class="btn" onclick="add(${i})">Add to Cart</button>
      </div>
    `;
  });
}

function filterProducts(){
  const s = document.getElementById("search").value.toLowerCase();
  const c = document.getElementById("category").value;
  render(products.filter(p =>
    p.name.toLowerCase().includes(s) &&
    (c === "all" || p.category === c)
  ));
}

function chg(i,d){
  qty[i] += d;
  if(qty[i] < 1) qty[i] = 1;
  document.getElementById("q"+i).innerText = qty[i];
}

function add(i){
  const p = products[i];
  const found = cart.find(x => x.name === p.name);
  if(found) found.qty += qty[i];
  else cart.push({name:p.name, price:p.price, qty:qty[i]});
  qty[i] = 1;
  document.getElementById("q"+i).innerText = 1;
  document.getElementById("cartCount").innerText = cart.length;
}

function openCart(){
  document.getElementById("cartSidebar").classList.add("open");
  let html = "";
  let sub = 0;

  cart.forEach(item=>{
    const t = item.qty * item.price;
    sub += t;
    html += `<div style="border-bottom:1px solid #e5e7eb;padding:8px 0">
      <b>${item.name}</b><br>
      ${item.qty} x â‚¦${item.price} = â‚¦${t}
    </div>`;
  });

  document.getElementById("cartItems").innerHTML = html || "Cart empty";
  document.getElementById("cartTotal").innerHTML =
    `Subtotal â‚¦${sub}<br>
     Delivery â‚¦${cart.length ? DELIVERY_FEE : 0}<br>
     <b>Total â‚¦${cart.length ? sub + DELIVERY_FEE : 0}</b>`;
}

function closeCart(){
  document.getElementById("cartSidebar").classList.remove("open");
}

function checkoutWhatsApp(){
  if(!cart.length){
    alert("Cart is empty");
    return;
  }

  let msg = "ðŸ§¾ New Order%0A";
  let total = 0;

  cart.forEach((item,i)=>{
    total += item.price * item.qty;
    msg += (i+1) + ". " + item.name + " x" + item.qty +
           " â‚¦" + (item.price * item.qty) + "%0A";
  });

  msg += "%0ATotal â‚¦" + total;

  window.open("https://wa.me/2349030013293?text=" + msg, "_blank");
}

loadProducts();

</script>

</body>
</html>

