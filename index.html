<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHI'S EMPIRE</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f8fafc;}
header{background:#0f172a;color:#fff;padding:1rem;text-align:center;}
.controls{display:flex;gap:8px;padding:10px;background:#fff;position:sticky;top:0;z-index:10;}
.controls input,.controls select{padding:10px;flex:1;border-radius:8px;border:1px solid #cbd5e1;}
.catalog{padding:1rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;}
.product{background:#fff;border-radius:12px;padding:10px;box-shadow:0 6px 16px rgba(0,0,0,.08);display:flex;flex-direction:column;position:relative;}
.product img{width:100%;height:160px;object-fit:cover;border-radius:10px;}
.product h3{font-size:1.05rem;margin:6px 0;}
.meta{font-size:.8rem;color:#64748b;}
.price{margin:6px 0;}
.qty-box{display:flex;align-items:center;gap:10px;margin:6px 0;}
.qty-box button{padding:8px 12px;font-size:1rem;cursor:pointer;}
.btn{background:#25d366;color:#fff;padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.cart-btn{position:fixed;bottom:20px;right:20px;background:#0f172a;color:#fff;padding:16px 20px;border-radius:40px;border:none;z-index:200;}
#cartSidebar{position:fixed;top:0;right:-420px;width:380px;height:100%;background:#fff;box-shadow:-8px 0 30px rgba(0,0,0,.25);z-index:1000;transition:right .35s ease;display:flex;flex-direction:column;}
#cartSidebar.open{right:0;}
#cartBox{flex:1;overflow-y:auto;padding:1rem;}
#cartBackdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:.3s;z-index:900;}
#cartSidebar.open~#cartBackdrop{opacity:1;pointer-events:auto;}
#checkoutBtn{width:100%;padding:14px;font-size:1.05rem;margin-top:10px;}
@media(max-width:600px){#cartSidebar{width:100%;height:85%;bottom:-100%;top:auto;right:0;border-radius:16px 16px 0 0;transition:bottom .35s ease;}#cartSidebar.open{bottom:0;}}
#toast{position:fixed;bottom:120px;right:20px;background:#25d366;color:#fff;padding:12px 18px;border-radius:8px;opacity:0;transition:.3s;}
#toast.show{opacity:1;}
.badge{position:absolute;top:10px;left:10px;padding:4px 8px;background:red;color:#fff;border-radius:6px;font-size:.8rem;}
</style>
</head>
<body>
<header>
  <h2>CHI'S EMPIRE</h2>
  <p>Store</p>
</header>

<div class="controls">
  <input id="search" placeholder="Search..." onkeyup="filterProducts()">
  <select id="category" onchange="filterProducts()">
    <option value="all">All</option>
    <option value="Clothing">Clothing</option>
    <option value="Shoes">Shoes</option>
    <option value="Kitchen">Kitchen</option>
  </select>
</div>

<section id="catalog" class="catalog"></section>
<button class="cart-btn" onclick="openCart()">üõí Cart (<span id="cartCount">0</span>)</button>
<div id="toast">Added to cart</div>

<div id="cartSidebar">
  <div id="cartBox">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <p id="cartTotal"></p>

    <h4>Delivery Details</h4>
    <input id="custName" placeholder="Full Name" style="width:100%;padding:10px;margin:6px 0">
    <input id="custPhone" placeholder="Phone Number" style="width:100%;padding:10px;margin:6px 0">
    <input id="custAddress" placeholder="Delivery Address" style="width:100%;padding:10px;margin:6px 0">
    <input id="custCity" placeholder="City / Area" style="width:100%;padding:10px;margin:6px 0">
    <textarea id="custNote" placeholder="Extra note (optional)" style="width:100%;padding:10px;margin:6px 0"></textarea>

    <button id="checkoutBtn" class="btn" onclick="checkoutWhatsApp()">Checkout on WhatsApp</button>
    <button onclick="closeCart()" style="width:100%;margin-top:8px;">Continue Shopping</button>
  </div>
</div>
<div id="cartBackdrop" onclick="closeCart()"></div>

<script>
const csvURL = "https://api.allorigins.win/raw?url=https://docs.google.com/spreadsheets/d/e/2PACX-1vSU7G-P1I6LZ7x2-2WDWkEHOpglxXTy8yk82pzMgZ4wt903OsbFOkx42ijOrVw4WJmP_9Y8c499Z-EF/pub?output=csv";
const WHATSAPP_NUMBER = "2347057829344";
const DELIVERY_FEE = ;
let products=[], cart=[], qty={};

fetch(https://api.allorigins.win/raw?url=https://docs.google.com/spreadsheets/d/e/2PACX-1vSU7G-P1I6LZ7x2-2WDWkEHOpglxXTy8yk82pzMgZ4wt903OsbFOkx42ijOrVw4WJmP_9Y8c499Z-EF/pub?output=csv).then(r=>r.text()).then(data=>{
  data.trim().split("\n").slice(1).forEach((r,i)=>{
    const [id,name,category,brand,price,colors,sizes,stock_map,image,discount]=r.split(",");
    const stockObj={};
    stock_map.split(";").forEach(s=>{
      const [k,v]=s.split("="); stockObj[k]=+v;
    });
    products.push({id,name,category,brand,price:+price,image,colors:colors.split("|"),sizes:sizes.split("|"),stock:stockObj,discount:+discount||0});
    qty[i]=1;
  });
  render(products);
});

function render(list){
  catalog.innerHTML="";
  list.forEach((p,i)=>{
    let badge="";
    let outOfStock = Object.values(p.stock).every(s=>s===0);
    if(outOfStock) badge="Out of Stock";
    else if(Math.min(...Object.values(p.stock))<=3) badge="Low Stock";
    let price = p.discount||p.price;
    catalog.innerHTML+=`
      <div class="product">
        ${badge?`<div class="badge">${badge}</div>`:""}
        <img src="${p.image}">
        <h3>${p.name}</h3>
        <div class="meta">${p.brand} ‚Ä¢ ${p.category}</div>
        <div>Color: ${p.colors.join(", ")}</div>
        <div>Size: ${p.sizes.join(", ")}</div>
        <div class="price"><b>‚Ç¶${price}</b></div>
        <div class="qty-box">
          <button onclick="chg(${i},-1)">‚ûñ</button>
          <span id="q${i}">${qty[i]}</span>
          <button onclick="chg(${i},1)">‚ûï</button>
        </div>
        <button class="btn" onclick="add('${p.name}',${price},${i})" ${outOfStock?"disabled":""}>Add to Cart</button>
      </div>`;
  });
}

function filterProducts(){
  const s=search.value.toLowerCase();
  const c=category.value;
  render(products.filter(p=>p.name.toLowerCase().includes(s)&&(c=="all"||p.category==c)));
}

function chg(i,d){ qty[i]+=d; if(qty[i]<1) qty[i]=1; document.getElementById("q"+i).innerText=qty[i]; }

function add(name,price,i){
  const f=cart.find(x=>x.name==name); if(f) f.qty+=qty[i]; else cart.push({name,price,qty:qty[i]}); qty[i]=1; document.getElementById("q"+i).innerText=1;
  cartCount.innerText=cart.length; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),1200);
}

function openCart(){
  cartSidebar.classList.add("open"); let html="", sub=0;
  cart.forEach((i,n)=>{ const t=i.qty*i.price; sub+=t; html+=`<div style="border-bottom:1px solid #e5e7eb;padding:8px 0"><b>${i.name}</b><div style="display:flex;gap:8px;align-items:center"><button onclick="mod(${n},-1)">‚ûñ</button>${i.qty}<button onclick="mod(${n},1)">‚ûï</button><span style="margin-left:auto">‚Ç¶${t}</span><button onclick="del(${n})">‚ùå</button></div></div>`; });
  cartItems.innerHTML=html||"<p>Cart empty</p>";
  cartTotal.innerHTML=`Subtotal ‚Ç¶${sub}<br>Delivery ‚Ç¶${cart.length?DELIVERY_FEE:0}<br><b>Total ‚Ç¶${cart.length?sub+DELIVERY_FEE:0}</b>`;
}

function mod(i,d){ cart[i].qty+=d; if(cart[i].qty<=0) cart.splice(i,1); openCart(); }
function del(i){ cart.splice(i,1); openCart(); }
function closeCart(){ cartSidebar.classList.remove("open"); }

function checkoutWhatsApp(){

  if(!cart.length) return alert("Cart is empty");

  if(!custName.value || !custPhone.value || !custAddress.value || !custCity.value){
    return alert("Fill delivery details");
  }

  cart.forEach(item => {

    fetch("https://docs.google.com/forms/d/e/1FAIpQLScH9MYQZWLDLs7AO4D5a9RjQSuLR74KM83VrKEsUhfCb-c55Q/formResponse", {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body:
        "entry.111=" + encodeURIComponent(item.name) +
        "&entry.222=" + encodeURIComponent(item.color || "Default") +
        "&entry.333=" + encodeURIComponent(item.size || "Default") +
        "&entry.444=" + item.qty +
        "&entry.555=" + encodeURIComponent(custName.value) +
        "&entry.666=" + encodeURIComponent(custPhone.value) +
        "&entry.777=" + encodeURIComponent(custAddress.value) +
        "&entry.888=" + encodeURIComponent(custCity.value)
    });

  });

  let msg = "üßæ New Order%0A";
  let total = 0;

  cart.forEach((item,i)=>{
    total += item.price * item.qty;
    msg += (i+1)+". "+item.name+" x"+item.qty+" ‚Ç¶"+(item.price*item.qty)+"%0A";
  });

  msg += "%0ATotal ‚Ç¶"+total;

  window.open("https://wa.me/2349030013293?text="+msg,"_blank");

  cart=[];
  cartCount.innerText=0;
  closeCart();
}
</script>
</body>
</html>


